{
  "complexity": "complex",
  "workflow_type": "feature",
  "confidence": 0.90,
  "reasoning": "Entity resolution is a greenfield feature requiring Rust backend implementation (not TypeScript-only as initially assessed). Requires multiple external integrations (Rust fuzzy matching library + frontend graph visualization library), new database schema for entity relationships and validations, research into entity matching algorithms, and cross-cutting architectural changes. High data quality risk in legal/investigative context.",

  "analysis": {
    "scope": {
      "estimated_files": 18,
      "estimated_services": 2,
      "is_cross_cutting": true,
      "notes": "CORRECTED: Codebase analysis reveals Rust/Tauri backend architecture (src-tauri/), not TypeScript-only. Will require: (1) Rust entity matching engine module, (2) Database schema additions (entity_matches, entity_validations tables), (3) Tauri command handlers for entity matching/validation API, (4) Frontend components for graph visualization, (5) Frontend UI for user validation workflow, (6) Integration with existing entities table and analysis engine patterns."
    },
    "integrations": {
      "external_services": [],
      "new_dependencies": [
        "strsim or fuzzy-matcher (Rust fuzzy string matching)",
        "react-force-graph or cytoscape (frontend graph visualization)"
      ],
      "research_needed": true,
      "notes": "CORRECTED: Requires two separate integrations: (1) Rust-side fuzzy matching library for name similarity (Levenshtein, Jaro-Winkler algorithms), (2) Frontend graph visualization library for entity network display. Research needed for: fuzzy matching algorithm selection and tuning, graph visualization library selection, entity resolution confidence scoring methodologies, and integration patterns between Rust backend and TypeScript frontend via Tauri commands."
    },
    "infrastructure": {
      "docker_changes": false,
      "database_changes": true,
      "config_changes": true,
      "notes": "CORRECTED: SQLite database (not external DB) needs schema additions: entity_matches table (stores proposed entity linkages with confidence scores), entity_validations table (stores user confirm/reject decisions for audit trail). Configuration changes for confidence threshold tuning and matching sensitivity parameters. No Docker changes (Tauri desktop application)."
    },
    "knowledge": {
      "patterns_exist": true,
      "research_required": true,
      "unfamiliar_tech": [
        "rust-fuzzy-string-matching",
        "graph-visualization",
        "entity-resolution-algorithms"
      ],
      "notes": "CORRECTED: Found existing patterns for entity storage (entities table with aliases field in schema.rs), analysis engines (SAM executor pattern in src-tauri/src/sam/), and Tauri command handlers (commands/analysis.rs). However, NO existing patterns for: fuzzy string matching in Rust, graph data structures, entity resolution logic, or graph visualization. This is greenfield architecture requiring careful design and self-critique phase."
    },
    "risk": {
      "level": "high",
      "concerns": [
        "False positives - incorrectly merging different entities (e.g., 'Dr. Smith' + 'John Smith' = wrong person)",
        "False negatives - missing legitimate entity matches reduces accountability tracking",
        "Performance at scale - matching N entities against M mentions has O(N*M) complexity",
        "User experience - validation workflow must be intuitive for non-technical legal professionals",
        "Data quality impact - errors propagate through analysis engines (SAM, contradictions, etc.)",
        "Algorithm tuning - confidence thresholds need careful calibration to balance precision/recall",
        "Security - entity data handling and relationship tracking in legal context"
      ],
      "notes": "CRITICAL: Entity resolution errors have serious consequences in legal/investigative use cases. False matches could conflate different people (e.g., merging expert witnesses), while missed matches reduce system's ability to track accountability across documents. High-stakes domain requires conservative confidence thresholds, transparent scoring, and robust user validation workflow with audit trail."
    }
  },

  "recommended_phases": [
    "discovery",
    "requirements",
    "research",
    "context",
    "spec_writing",
    "self_critique",
    "planning",
    "validation"
  ],

  "flags": {
    "needs_research": true,
    "needs_self_critique": true,
    "needs_infrastructure_setup": false
  },

  "validation_recommendations": {
    "risk_level": "high",
    "skip_validation": false,
    "minimal_mode": false,
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scan_required": true,
    "staging_deployment_required": false,
    "reasoning": "Entity tracking involves user data privacy concerns requiring security scan. Complex matching logic needs unit tests for accuracy validation. Database operations need integration tests. User validation workflow requires E2E tests to verify UI interactions work correctly. High accuracy requirements demand comprehensive testing despite being standard complexity."
  },

  "created_at": "2026-01-05T19:15:00Z"
}
