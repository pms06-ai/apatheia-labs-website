{
  "feature": "Complete Temporal Analysis Engine",
  "workflow_type": "feature",
  "workflow_rationale": "New capability implementation that extends the existing analysis engine suite. Adds date extraction, normalization, and inconsistency detection as a new analysis dimension. Follows the same pattern as entity-resolution, omission, and narrative engines.",
  "phases": [
    {
      "id": "phase-1-dependencies",
      "name": "Install Dependencies",
      "type": "setup",
      "description": "Install chrono-node library for natural language date parsing and validation",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Add chrono-node dependency to package.json",
          "service": "typescript",
          "files_to_modify": [
            "package.json"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'chrono-node' package.json && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "chrono-node dependency already exists in package.json at version ^2.7.7. Verification passed.",
          "updated_at": "2026-01-06T03:01:56.363885+00:00"
        }
      ]
    },
    {
      "id": "phase-2-core-implementation",
      "name": "Core Temporal Engine Implementation",
      "type": "implementation",
      "description": "Implement multi-layer date extraction and validation pipeline (AI \u2192 chrono-node \u2192 date-fns)",
      "depends_on": [
        "phase-1-dependencies"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Enhance TemporalEvent and TemporalAnalysisResult interfaces with Phase 1 fields",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/engines/entity-resolution.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'rawText' src/lib/engines/temporal.ts && grep -q 'position' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Enhanced interfaces with Phase 1 fields: TemporalEvent (rawText, position, dateType, anchorDate, extractionMethod), TemporalInconsistency (type), TemporalAnalysisResult (metadata). Commit: 3a74c86. Verification passed.",
          "updated_at": "2026-01-06T03:03:31.762462+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Implement Layer 1: AI date extraction with context",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/ai-client.ts",
            "src/lib/engines/entity-resolution.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'generateJSON' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Implemented Layer 1: AI date extraction with context. Enhanced AI_DATE_EXTRACTION_PROMPT to request Phase 1 fields (rawText, position, dateType, anchorDate). Updated event mapping to include all Phase 1 enhancement fields including extractionMethod='ai'. Added metadata to result with documentsAnalyzed, datesExtracted, validationLayersUsed. Created getMockTemporalResult() for realistic mock data. Commit: d4fb48f. Verification passed: generateJSON is used in temporal.ts.",
          "updated_at": "2026-01-06T03:05:56.054191+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Implement Layer 2: chrono-node validation to prevent hallucination",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'chrono' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Layer 2 chrono-node validation implemented and committed (ba0aa71). Added validateWithChronoNode() function to verify AI-extracted dates exist in source text by matching raw text, position (\u00b110 chars), or parsed date value. Added filterHallucinatedDates() to remove unvalidated low-confidence absolute dates. Updated parseTemporalEvents() to use chrono-node validation layer and updated metadata.validationLayersUsed to include 'chrono'. Verification passed: grep confirms 'chrono' exists in temporal.ts.",
          "updated_at": "2026-01-06T03:08:46.084159+00:00"
        },
        {
          "id": "subtask-2-4",
          "description": "Implement Layer 3: date-fns normalization and validation",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'import.*format.*from.*date-fns' src/lib/engines/temporal.ts && grep -q 'isValid' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Layer 3 date-fns normalization and validation implemented and committed (6553c85). Added normalizeWithDateFns() function that: (1) Parses dates using parseISO with Date constructor fallback, (2) Validates dates with isValid(), (3) Normalizes to YYYY-MM-DD format with format(), (4) Filters out invalid dates. The function is integrated into parseTemporalEvents() pipeline and metadata now includes 'date-fns' in validationLayersUsed. Verification passed.",
          "updated_at": "2026-01-06T03:10:57.858198+00:00"
        }
      ]
    },
    {
      "id": "phase-3-temporal-logic",
      "name": "Temporal Logic & Inconsistency Detection",
      "type": "implementation",
      "description": "Implement backdating detection, relative date resolution, and impossible sequence detection",
      "depends_on": [
        "phase-2-core-implementation"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Implement relative date resolution with anchor detection",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'addWeeks\\|addDays\\|addMonths' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Implemented relative date resolution with anchor detection. Added:\n- RelativeDatePattern interface and RELATIVE_DATE_PATTERNS array with 17 patterns for weeks/days/months/years (using addWeeks, addDays, addMonths, addYears, subWeeks, subDays, subMonths, subYears from date-fns)\n- parseNumberWord() function to handle written numbers (\"three\") and digit strings\n- attemptRelativeDateResolution() to match raw text against patterns\n- detectAnchorDates() to build anchor candidates from absolute dates by document and position\n- findAnchorDate() with priority: explicit anchorDate > nearest preceding date by position > earliest in document\n- resolveRelativeDates() Layer 4 function integrated into parseTemporalEvents pipeline\n- Events flagged with REQUIRES_ANCHOR when no anchor date available\n- Chrono-node fallback resolution with reference date\nVerification passed: grep confirms addWeeks/addDays/addMonths present in temporal.ts. Commit: 0c1d098.",
          "updated_at": "2026-01-06T03:14:47.496370+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Implement backdating detection (document date < referenced event date)",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/engines/omission.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'isBefore\\|isAfter' src/lib/engines/temporal.ts && grep -q 'TEMPORAL_IMPOSSIBILITY\\|BACKDATING' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Backdating detection implemented and committed (b740e89). Added:\\n- detectBackdating() function (lines 602-651) that compares event dates against document creation/acquisition dates using date-fns isAfter()\\n- BackdatingResult interface for structured findings\\n- TEMPORAL_IMPOSSIBILITY descriptions with days difference calculation\\n- Severity classification: critical (>30 days), high (>7 days), medium (<=7 days)\\n- type: 'BACKDATING' in TemporalInconsistency\\n- Integration into parseTemporalEvents() pipeline (line 818)\\n- deduplicateInconsistencies() to prevent duplicate findings\\nVerification passed: grep confirms isBefore/isAfter and TEMPORAL_IMPOSSIBILITY/BACKDATING present in temporal.ts.",
          "updated_at": "2026-01-06T13:58:28.318043+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Implement cross-document timeline contradiction detection",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/engines/narrative.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'IMPOSSIBLE_SEQUENCE\\|CONTRADICTION' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Implemented detectCrossDocumentContradictions() function with: event signature matching for similarity detection, CONTRADICTION type for same events with different dates across documents, IMPOSSIBLE_SEQUENCE type for cross-document reference inconsistencies. Integrated as Layer 7 in the validation pipeline. Verification passes.",
          "updated_at": "2026-01-06T14:01:41.469818+00:00"
        }
      ]
    },
    {
      "id": "phase-4-engine-integration",
      "name": "Engine Registry Integration",
      "type": "integration",
      "description": "Register temporal engine in the engine registry and export properly",
      "depends_on": [
        "phase-3-temporal-logic"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Export temporal engine from temporal.ts following existing pattern",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/temporal.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/engines/entity-resolution.ts",
            "src/lib/engines/omission.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'export const temporalEngine' src/lib/engines/temporal.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Export already exists at lines 1198-1200: `export const temporalEngine = { parseTemporalEvents }`. Verification passes.",
          "updated_at": "2026-01-06T14:02:51.251370+00:00"
        },
        {
          "id": "subtask-4-2",
          "description": "Register temporal engine in index.ts if not already present",
          "service": "typescript",
          "files_to_modify": [
            "src/lib/engines/index.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/lib/engines/index.ts"
          ],
          "verification": {
            "type": "command",
            "command": "grep -q 'temporal' src/lib/engines/index.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Registered temporal engine in index.ts: added import, added to EngineResult union type, added temporal case in runEngine switch, and re-exported temporalEngine and types. Verification passed - grep found 'temporal' in index.ts.",
          "updated_at": "2026-01-06T14:04:49.306881+00:00"
        }
      ]
    },
    {
      "id": "phase-5-testing",
      "name": "Unit and Integration Testing",
      "type": "implementation",
      "description": "Create comprehensive test suite for temporal analysis engine",
      "depends_on": [
        "phase-4-engine-integration"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create unit tests for date extraction accuracy (95%+ target)",
          "service": "typescript",
          "files_to_modify": [],
          "files_to_create": [
            "src/__tests__/engines/temporal.test.ts"
          ],
          "patterns_from": [
            "src/__tests__/engines/engines.test.ts"
          ],
          "verification": {
            "type": "command",
            "command": "test -f src/__tests__/engines/temporal.test.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Created comprehensive unit test suite for temporal analysis engine in src/__tests__/engines/temporal.test.ts. Tests include: Ground truth dataset with 10+ date format test cases for 95%+ accuracy, Layer 2 chrono-node validation (position tracking, hallucination filtering, edge cases), Layer 3 date-fns normalization and immutability verification, Relative date resolution patterns (three weeks later = 2024-01-22), Backdating detection (TEMPORAL_IMPOSSIBILITY), Cross-document contradiction detection, Impossible sequence detection, Multi-document timeline reconstruction with citation tracking, Edge case handling. Commit: 6f8ac71.",
          "updated_at": "2026-01-06T14:08:56.184534+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Create unit tests for relative date resolution",
          "service": "typescript",
          "files_to_modify": [
            "src/__tests__/engines/temporal.test.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'three weeks later' src/__tests__/engines/temporal.test.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "completed",
          "notes": "Added comprehensive unit tests for relative date resolution including: pattern tests for weeks/days/months/years later/earlier, integration tests with parseTemporalEvents, anchor detection tests, REQUIRES_ANCHOR flagging tests, edge cases for boundaries and leap years. Verification passed: grep confirms 'three weeks later' is present in test file.",
          "updated_at": "2026-01-06T14:11:30.672718+00:00"
        },
        {
          "id": "subtask-5-3",
          "description": "Create unit tests for backdating and impossibility detection",
          "service": "typescript",
          "files_to_modify": [
            "src/__tests__/engines/temporal.test.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'TEMPORAL_IMPOSSIBILITY\\|backdating' src/__tests__/engines/temporal.test.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "pending",
          "notes": "Test document dated March 1 referencing March 15 event triggers flag. Test cross-document contradictions."
        },
        {
          "id": "subtask-5-4",
          "description": "Create integration test for multi-document timeline reconstruction",
          "service": "typescript",
          "files_to_modify": [
            "src/__tests__/engines/temporal.test.ts"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "grep -q 'multi-document\\|timeline reconstruction' src/__tests__/engines/temporal.test.ts && echo 'OK' || echo 'MISSING'",
            "expected": "OK"
          },
          "status": "pending",
          "notes": "Test with 3+ documents containing overlapping events. Verify chronological ordering, citation tracking, contradiction detection."
        }
      ]
    },
    {
      "id": "phase-6-verification",
      "name": "QA Verification & Final Checks",
      "type": "integration",
      "description": "Run full test suite, verify no regressions, check code quality",
      "depends_on": [
        "phase-5-testing"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Run type-check, lint, and format commands",
          "service": "typescript",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Run: npm run type-check && npm run lint && npm run format:check. All should pass with 0 errors."
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Run full test suite and verify 95%+ accuracy threshold",
          "service": "typescript",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Run: npm test. Verify temporal.test.ts passes with \u226595% accuracy on ground-truth dataset. Verify no regressions in other engine tests."
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-3",
          "description": "Manual verification: Test with real documents",
          "service": "typescript",
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Test parseTemporalEvents() with real institutional documents. Verify: (1) No hallucinated dates, (2) Citation positions accurate \u00b15 chars, (3) Backdating detected correctly, (4) Confidence scores meaningful."
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 6,
    "total_subtasks": 15,
    "services_involved": [
      "typescript"
    ],
    "parallelism": {
      "max_parallel_phases": 1,
      "parallel_groups": [],
      "recommended_workers": 1,
      "speedup_estimate": "Sequential execution required due to dependencies"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 012 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "Date extraction achieves \u226595% accuracy on test dataset",
      "Relative dates resolve correctly when anchor exists",
      "Backdating automatically detected and flagged",
      "Cross-document timeline contradictions identified",
      "All dates include citation tracking (text + position)",
      "No regressions in existing engine tests",
      "Type-check, lint, and format checks pass"
    ],
    "verification_steps": [
      {
        "name": "Type Check",
        "command": "npm run type-check",
        "expected_outcome": "0 TypeScript errors",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Linting",
        "command": "npm run lint",
        "expected_outcome": "0 ESLint errors/warnings",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Unit Tests",
        "command": "npm test -- src/__tests__/engines/temporal.test.ts",
        "expected_outcome": "All tests pass, 95%+ accuracy threshold met",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Regression Tests",
        "command": "npm test",
        "expected_outcome": "All existing engine tests still pass",
        "type": "test",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "High risk due to 95% accuracy requirement and complex temporal reasoning. Requires comprehensive unit tests for each validation layer and integration tests for multi-document analysis."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "npm test -- src/__tests__/engines/temporal.test.ts"
      ],
      "minimum_coverage": 95
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "npm test"
      ],
      "services_to_test": [
        "typescript"
      ]
    },
    "e2e_tests": {
      "required": false,
      "commands": [],
      "flows": []
    },
    "browser_verification": {
      "required": false,
      "pages": []
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": null,
  "status": "in_progress",
  "planStatus": "in_progress",
  "updated_at": "2026-01-06T13:57:06.107Z",
  "recoveryNote": "Task recovered from stuck state at 2026-01-06T13:57:06.107Z",
  "last_updated": "2026-01-06T14:11:30.672718+00:00"
}